<section id="faci" class="facilities-tabbed-grid-section">
  <div class="facilities-header" data-aos="fade-up">
    <h2 class="facilities-title" data-i18n="facilities_main_title">
      Discover Our <span class="highlight-blue">Campus Amenities</span>
    </h2>
    <p class="facilities-subtitle" data-i18n="facilities_subtitle">
      Tharlam Academy offers a comprehensive array of modern facilities,
      thoughtfully designed to enrich every aspect of our students' academic,
      spiritual, and daily lives.
    </p>
  </div>

  <div
    class="facilities-tabs-container"
    data-aos="fade-up"
    data-aos-delay="150"
  >
    <button
      class="tab-btn active"
      data-category="academic"
      data-i18n="facilities_tab_academic">Learning Spaces</button
    >
    <button
      class="tab-btn"
      data-category="residential"
      data-i18n="facilities_tab_residential">Living & Dining</button
    >
    <button
      class="tab-btn"
      data-category="recreational"
      data-i18n="facilities_tab_recreational">Recreation</button
    >
    <button
      class="tab-btn"
      data-category="spiritual"
      data-i18n="facilities_tab_spiritual">Spiritual Practice</button
    >
    <button
      class="tab-btn"
      data-category="support"
      data-i18n="facilities_tab_support">Essential Services</button
    >
  </div>

  <div class="facilities-grid-content">
    <div
      class="facility-card"
      data-category="academic"
      data-aos="fade-up"
      data-aos-delay="100"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Modern Classrooms"
          data-i18n-alt="facility_academic_classroom_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_academic_classroom_title">
        Classrooms
      </div>
    </div>
    <div
      class="facility-card"
      data-category="academic"
      data-aos="fade-up"
      data-aos-delay="200"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Extensive Library"
          data-i18n-alt="facility_academic_library_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_academic_library_title">
        Library
      </div>
    </div>
    <div
      class="facility-card"
      data-category="academic"
      data-aos="fade-up"
      data-aos-delay="300"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Advanced Computer Lab"
          data-i18n-alt="facility_academic_lab_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_academic_lab_title">
        Computer Lab
      </div>
    </div>

    <div
      class="facility-card"
      data-category="residential"
      data-aos="fade-up"
      data-aos-delay="100"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Comfortable Dormitories"
          data-i18n-alt="facility_res_dormitory_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_res_dormitory_title">
        Comfortable Residences
      </div>
    </div>
    <div
      class="facility-card"
      data-category="residential"
      data-aos="fade-up"
      data-aos-delay="200"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Hygienic Dining Hall"
          data-i18n-alt="facility_res_dining_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_res_dining_title">
        Hygienic Dining Hall
      </div>
    </div>
    <div
      class="facility-card"
      data-category="residential"
      data-aos="fade-up"
      data-aos-delay="300"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Spacious Rooms"
          data-i18n-alt="facility_res_rooms_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_res_rooms_title">
        Spacious Rooms
      </div>
    </div>

    <div
      class="facility-card"
      data-category="recreational"
      data-aos="fade-up"
      data-aos-delay="100"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Spacious Sports Ground"
          data-i18n-alt="facility_rec_sports_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_rec_sports_title">
        Outdoor Sports Ground
      </div>
    </div>
    <div
      class="facility-card"
      data-category="recreational"
      data-aos="fade-up"
      data-aos-delay="200"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Recreational Play Area"
          data-i18n-alt="facility_rec_play_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_rec_play_title">
        Recreational Play Area
      </div>
    </div>
    <div
      class="facility-card"
      data-category="recreational"
      data-aos="fade-up"
      data-aos-delay="300"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Fitness Center"
          data-i18n-alt="facility_rec_fitness_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_rec_fitness_title">
        Fitness Center
      </div>
    </div>

    <div
      class="facility-card"
      data-category="spiritual"
      data-aos="fade-up"
      data-aos-delay="100"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Serene Meditation Hall"
          data-i18n-alt="facility_spi_meditation_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_spi_meditation_title">
        Serene Meditation Hall
      </div>
    </div>
    <div
      class="facility-card"
      data-category="spiritual"
      data-aos="fade-up"
      data-aos-delay="200"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Monastery Temple"
          data-i18n-alt="facility_spi_temple_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_spi_temple_title">
        Monastery Temple
      </div>
    </div>
    <div
      class="facility-card"
      data-category="spiritual"
      data-aos="fade-up"
      data-aos-delay="300"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Sacred Shrine"
          data-i18n-alt="facility_spi_shrine_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_spi_shrine_title">
        Sacred Shrine
      </div>
    </div>

    <div
      class="facility-card"
      data-category="support"
      data-aos="fade-up"
      data-aos-delay="100"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Health Clinic"
          data-i18n-alt="facility_sup_clinic_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_sup_clinic_title">
        On-Campus Health Clinic
      </div>
    </div>
    <div
      class="facility-card"
      data-category="support"
      data-aos="fade-up"
      data-aos-delay="200"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Administrative Block"
          data-i18n-alt="facility_sup_office_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_sup_office_title">
        Tharlam Offices
      </div>
    </div>
    <div
      class="facility-card"
      data-category="support"
      data-aos="fade-up"
      data-aos-delay="300"
    >
      <div class="card-image-placeholder">
        <img
          src="house.png"
          alt="Campus Security"
          data-i18n-alt="facility_sup_security_alt"
        />
      </div>
      <div class="card-title" data-i18n="facility_sup_security_title">
        Campus Security
      </div>
    </div>
  </div>
</section>

<style>
  /* --- Facilities Section (Tabbed Grid Layout) --- */

  /* Main Section Container */
  .facilities-tabbed-grid-section {
    padding: 10px 20px;
    background-color: white;
    color: #333;
    overflow: hidden;
    text-align: center;
  }

  /* Section Header */
  .facilities-header {
    max-width: 800px;
    margin: 0 auto 10px auto;
    padding: 0 20px;
  }

  .facilities-title {
    font-size: 2rem;
    color: #001f3f;
    margin-bottom: 15px;
    position: relative;
    padding-bottom: 12px;
    font-weight: 700;
  }

  .facilities-title::after {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0;
    width: 80px;
    height: 4px;
    background-color: #001f3f;
    border-radius: 2px;
  }

  .facilities-subtitle {
    font-size: 12px;
    color: #555;
    line-height: 1.7;
    margin-top: 15px;
  }

  /* Tab Buttons Container */
  .facilities-tabs-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 40px;
    border-bottom: 2px solid #e0e0e0;
    padding-bottom: 15px;
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
  }

  .tab-btn {
    background-color: transparent;
    border: none;
    padding: 10px 20px;
    font-size: 1.05rem;
    font-weight: 600;
    color: #555;
    cursor: pointer;
    position: relative;
    transition:
      color 0.3s ease,
      background-color 0.3s ease;
    border-radius: 6px;
  }

  .tab-btn:hover {
    color: #001f3f;
    background-color: white;
  }

  .tab-btn.active {
    color: #001f3f;
    background-color: white;
    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
  }

  .tab-btn.active::after {
    content: "";
    position: absolute;
    bottom: -17px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 3px;
    background-color: #001f3f;
    border-radius: 2px;
  }

  /* Facilities Grid Content */
  .facilities-grid-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 30px;
    max-width: 1215px;
    margin: 0 auto;
    padding: 0 0px;
  }

  .facility-card {
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease,
      opacity 0.3s ease;
    cursor: pointer;
  }

  .facility-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
  }

  .card-image-placeholder {
    width: 100%;
    padding-bottom: 66.66%;
    position: relative;
    overflow: hidden;
    background-color: #f0f0f0;
  }

  .card-image-placeholder img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.4s ease;
  }

  .facility-card:hover .card-image-placeholder img {
    transform: scale(1.08);
  }

  .card-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #001f3f;
    padding: 18px 15px;
    text-align: center;
    background-color: #ffffff;
    border-top: 1px solid #f0f0f0;
  }

  /* Hidden and Visible states for cards */
  .facility-card.hidden {
    display: none;
    opacity: 0;
    transform: scale(0.9);
  }

  .facility-card.visible {
    display: flex;
    opacity: 1;
    transform: scale(1);
  }

  /* --- Responsive Adjustments --- */

  /* Tablets and smaller desktops (max-width: 992px) */
  @media (max-width: 992px) {
    .facilities-tabbed-grid-section {
      padding: 60px 15px;
    }

    .facilities-title {
      font-size: 2.2rem;
      margin-bottom: 40px;
    }

    .facilities-title::after {
      width: 70px;
      height: 3px;
    }

    .facilities-tabs-container {
      gap: 10px;
      padding-bottom: 12px;
      margin-bottom: 30px;
    }

    .tab-btn {
      padding: 8px 15px;
      font-size: 0.95rem;
    }

    .tab-btn.active::after {
      bottom: -14px;
      width: 70%;
      height: 2px;
    }

    .facilities-grid-content {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }

    .card-image-placeholder {
      padding-bottom: 75%;
    }

    .card-title {
      font-size: 1.1rem;
      padding: 15px 12px;
    }
  }

  /* Mobile devices (max-width: 768px) */
  @media (max-width: 768px) {
    .facilities-tabbed-grid-section {
      padding: 50px 10px;
    }

    .facilities-header {
      margin-bottom: 30px;
    }

    .facilities-title {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .facilities-title::after {
      width: 60px;
      height: 2px;
    }

    .facilities-tabs-container {
      flex-direction: column;
      gap: 8px;
      padding-bottom: 10px;
      margin-bottom: 25px;
      border-bottom: none;
    }

    .tab-btn {
      width: 100%;
      padding: 10px 15px;
      font-size: 0.9rem;
      text-align: center;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }

    .tab-btn.active {
      border-color: #001f3f;
    }

    .tab-btn.active::after {
      display: none;
    }

    /* Key changes for horizontal carousel on mobile */
    .facilities-grid-content {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch; /* For smooth scrolling on iOS */
      scroll-snap-type: x mandatory; /* Makes it snap to each card */
      gap: 20px;
    }

    /* Hides the scrollbar for a cleaner look */
    .facilities-grid-content::-webkit-scrollbar {
      display: none;
    }
    .facilities-grid-content {
      scrollbar-width: none; /* For Firefox */
    }

    .facility-card {
      flex-shrink: 0;
      width: 85%;
      max-width: 350px;
      scroll-snap-align: center; /* Aligns the card in the center of the view */
    }
  }
</style>

<script>
  // Define the function that sets up all the tab/filter logic
  function initializeFacilitiesTabs() {
    // --- 1. Element Selection (MUST be inside the function) ---
    const tabButtons = document.querySelectorAll(
      ".facilities-tabs-container .tab-btn",
    );
    const facilityCards = document.querySelectorAll(
      ".facilities-grid-content .facility-card",
    );

    // --- 2. Filter Function (Helper) ---
    const filterFacilities = (category) => {
      facilityCards.forEach((card) => {
        const cardCategory = card.dataset.category;
        if (category === "all" || cardCategory === category) {
          card.classList.remove("hidden");
          card.classList.add("visible");
        } else {
          card.classList.remove("visible");
          card.classList.add("hidden");
        }
      });
    };

    // --- 3. Event Listener Setup ---
    const handleTabClick = (event) => {
      const button = event.currentTarget;
      tabButtons.forEach((btn) => btn.classList.remove("active"));
      button.classList.add("active");
      const category = button.dataset.category;
      filterFacilities(category);
    };

    tabButtons.forEach((button) => {
      // FIX: Remove previous listeners to prevent duplication on astro:page-load
      button.removeEventListener("click", handleTabClick);

      // Add the new listener
      button.addEventListener("click", handleTabClick);
    });

    // --- 4. Default Activation ---
    // Find and click the 'academic' tab to set the default state
    const academicTabButton = document.querySelector(
      '.facilities-tabs-container .tab-btn[data-category="academic"]',
    );
    if (academicTabButton) {
      academicTabButton.click();
    }
  }

  // --- EXECUTION TRIGGERS ---

  // 1. Initial Load (Hard navigation)
  document.addEventListener("DOMContentLoaded", initializeFacilitiesTabs);

  // 2. Astro View Transition (Soft navigation) - THE FIX
  document.addEventListener("astro:page-load", initializeFacilitiesTabs);
</script>
